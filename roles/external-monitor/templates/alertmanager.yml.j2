global:
  resolve_timeout: 5m
  smtp_from: '{{ external_monitor_smtp_from_address }}'
  smtp_smarthost: '{{ external_monitor_smtp_host }}'
  smtp_auth_username: '{{ external_monitor_smtp_user }}'
  smtp_auth_password: '{{ external_monitor_smtp_password }}'
  smtp_require_tls: true

# Route configuration
route:
  # Default receiver for all alerts
  receiver: 'email-alerts'
  
  # Group alerts by these labels
  group_by: ['alertname', 'cluster', 'service']
  
  # How long to wait before sending a notification about a new group of alerts
  group_wait: 30s
  
  # How long to wait before sending a notification about new alerts in a group
  group_interval: 5m
  
  # How long to wait before sending another notification if an alert is still firing
  repeat_interval: 4h

# Receivers configuration
receivers:
  - name: 'email-alerts'
    email_configs:
      - to: '{{ external_monitor_alert_email }}'
        # send_resolved: true # incase I want to get resolved emails.
        headers:
          Subject: 'ðŸš¨ [{{ "{{" }} .Status | toUpper {{ "}}" }}] Homelab Alert: {{ "{{" }} .GroupLabels.alertname {{ "}}" }}'
        html: |
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
              .alert { padding: 15px; margin: 10px 0; border-radius: 5px; }
              .firing { background-color: #fee; border-left: 4px solid #d00; }
              .resolved { background-color: #efe; border-left: 4px solid #0d0; }
              .label { display: inline-block; padding: 2px 8px; margin: 2px; background: #f0f0f0; border-radius: 3px; font-size: 0.9em; }
              h2 { color: #d00; }
              .resolved h2 { color: #0a0; }
            </style>
          </head>
          <body>
            <div class="alert {{ "{{" }} .Status {{ "}}" }}">
              <h2>{{ "{{" }} if eq .Status "firing" {{ "}}" }}ðŸš¨ ALERT FIRING{{ "{{" }} else {{ "}}" }}âœ… ALERT RESOLVED{{ "{{" }} end {{ "}}" }}</h2>
              <p><strong>Summary:</strong> {{ "{{" }} .GroupLabels.alertname {{ "}}" }}</p>
              {{ "{{" }} range .Alerts {{ "}}" }}
              <hr>
              <p><strong>Alert:</strong> {{ "{{" }} .Labels.alertname {{ "}}" }}</p>
              <p><strong>Description:</strong> {{ "{{" }} .Annotations.description {{ "}}" }}</p>
              <p><strong>Summary:</strong> {{ "{{" }} .Annotations.summary {{ "}}" }}</p>
              <p><strong>Severity:</strong> {{ "{{" }} .Labels.severity {{ "}}" }}</p>
              <p><strong>Started:</strong> {{ "{{" }} .StartsAt {{ "}}" }}</p>
              {{ "{{" }} if .EndsAt {{ "}}" }}<p><strong>Ended:</strong> {{ "{{" }} .EndsAt {{ "}}" }}</p>{{ "{{" }} end {{ "}}" }}
              <div>
                <strong>Labels:</strong><br>
                {{ "{{" }} range .Labels.SortedPairs {{ "}}" }}
                <span class="label">{{ "{{" }} .Name {{ "}}" }}: {{ "{{" }} .Value {{ "}}" }}</span>
                {{ "{{" }} end {{ "}}" }}
              </div>
              {{ "{{" }} end {{ "}}" }}
            </div>
          </body>
          </html>

# Inhibition rules
inhibit_rules:
  # Inhibit 'warning' alerts if 'critical' alert is already firing for the same alertname and instance
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
